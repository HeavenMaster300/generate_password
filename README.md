Генератор паролей с хранением в PostgreSQL
==========================================

Описание
--------
Проект представляет собой CLI‑утилиту для генерации безопасных паролей и их сохранения в базе данных PostgreSQL.
Пароли шифруются с помощью библиотеки cryptography (Fernet) и могут быть расшифрованы для просмотра.

Требования
----------
- Python 3.11 (или совместимая версия)
- PostgreSQL (сервер БД)
- Установленные пакеты:
  - cryptography
  - psycopg2-binary

Установка зависимостей
----------------------
1. (Опционально) создать и активировать виртуальное окружение.
2. Установить зависимости:

   pip install cryptography psycopg2-binary

Настройка PostgreSQL
--------------------
1. Создать базу данных (в SQL Shell или любом клиенте):

   CREATE DATABASE passgen;

2. Убедиться, что PostgreSQL запущен и доступен по адресу:
   - host: localhost
   - port: 5432

3. В файле db.py настроить параметры подключения:

   conn = psycopg2.connect(
       host="localhost",
       port="5432",
       database="passgen",
       user="postgres",
       password="ВАШ_ПАРОЛЬ_ОТ_POSTGRES"
   )

   При первом сохранении пароля модуль db.py/ init_database()
   автоматически создаст таблицу passwords со столбцами:
   - id (SERIAL, PK)
   - service (TEXT)
   - username (TEXT)
   - password (TEXT, зашифрованный)
   - created_at (TIMESTAMP)
   - updated_at (TIMESTAMP)
   - UNIQUE(service, username)

Шифрование паролей
------------------
Для шифрования используется Fernet из библиотеки cryptography.
Ключ шифрования автоматически создаётся при первом запуске и
сохраняется в файле secret.key в корне проекта. Этот файл нельзя терять:
без него нельзя будет расшифровать сохранённые пароли.

Использование CLI
-----------------
Запуск приложения:

   python main.py [ПАРАМЕТРЫ]

Основные параметры генерации пароля:
   --length N       длина пароля (по умолчанию 12)
   --special        добавить спецсимволы
   --digits         добавить цифры
   --uppercase      добавить заглавные буквы
   --lowercase      добавить строчные буквы

Параметры работы с хранилищем:
   --save           сохранить сгенерированный пароль в БД
   --service NAME   название сервиса (например, GitHub, Gmail)
   --username NAME  имя пользователя/логин для сервиса
   --find           найти и вывести пароль по сервису и пользователю
   --list           вывести список всех сохранённых записей (без паролей)

Примеры
-------
1. Сгенерировать пароль без сохранения:

   python main.py --length 16 --special --digits --uppercase --lowercase

2. Сгенерировать и сохранить пароль для GitHub:

   python main.py --length 20 --special --digits --uppercase --save --service GitHub --username HeavenMaster300

3. Найти и показать пароль для GitHub:

   python main.py --find --service GitHub --username HeavenMaster300

4. Вывести список всех сохранённых записей:

   python main.py --list

Структура проекта
-----------------
- main.py       — точка входа, запускает CLI.
- commands.py   — разбор аргументов командной строки, логика CLI.
- generator.py  — функции генерации пароля.
- storage.py    — шифрование/дешифрование и операции с БД (сохранение, получение, список).
- db.py         — подключение к PostgreSQL и инициализация таблицы.
- utils.py      — вспомогательные функции.
- secret.key    — ключ шифрования (создаётся автоматически, в git не коммитится).
- .gitignore    — настройки игнорирования служебных и секретных файлов.

Работа с Git
------------
После изменения кода или README можно выполнить:

   git add .
   git commit -m "Обновлена документация и логика работы с БД"
   git push origin master

Чтобы отправить коммиты на удалённый репозиторий используется команда git push origin <ветка>, например master. [web:7]

## Тестирование

В проекте используются модульные тесты на базе стандартного фреймворка `unittest`.  
Тесты лежат в пакете `tests` и покрывают как логику генерации паролей, так и работу с хранилищем в PostgreSQL.

### Структура тестов

- `tests/test_utils_and_generator.py`  
  Проверяет:
  - корректность функции `validate_length` (допустимый диапазон длины пароля);
  - генерацию пароля заданной длины;
  - реакцию на отсутствие выбранных наборов символов (ожидается `ValueError`);
  - что все символы сгенерированного пароля принадлежат допустимым наборам (буквы, цифры, спецсимволы);
  - наличие требуемых типов символов при соответствующих флагах (например, цифр и строчных букв).

- `tests/test_storage_db.py`  
  Проверяет:
  - корректное создание/получение ключа шифрования (`get_or_create_key`);
  - то, что шифрование и дешифрование пароля возвращает исходное значение;
  - сохранение пароля в БД и его последующее чтение через `get_password`;
  - перезапись пароля при повторном вызове `save_password` с тем же `service` и `username`;
  - наличие сохранённой записи в результате `list_all_passwords`.

Перед запуском тестов для БД предполагается, что:
- PostgreSQL запущен;
- база данных и параметры подключения настроены в `db.py`;
- таблица `passwords` создаётся автоматически через `init_database()` при первом обращении.

### Как запустить тесты

Из корня проекта (каталог с `main.py`):

python -m unittest


или с явным поиском тестов в каталоге `tests`:

python -m unittest discover -s tests

Обе команды запускают весь набор автотестов и выведут количество выполненных тестов и общий статус (`OK` при успешном прохождении).
